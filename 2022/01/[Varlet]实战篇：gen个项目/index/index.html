<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="2022/01/[Varlet]实战篇：gen个项目/index"><meta name="keywords" content=""><meta name="author" content="Joker"><meta name="copyright" content="Joker"><title>2022/01/[Varlet]实战篇：gen个项目/index | Joker's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#写在前面"><span class="toc-number">1.</span> <span class="toc-text">写在前面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#构建命令"><span class="toc-number">2.</span> <span class="toc-text">构建命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#前期准备"><span class="toc-number">3.</span> <span class="toc-text">前期准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#老朋友commander"><span class="toc-number">4.</span> <span class="toc-text">老朋友commander</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Step1-引用"><span class="toc-number">4.1.</span> <span class="toc-text">Step1.引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建gen命令"><span class="toc-number">4.2.</span> <span class="toc-text">创建gen命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gen要做啥"><span class="toc-number">5.</span> <span class="toc-text">gen要做啥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#同名检测"><span class="toc-number">6.</span> <span class="toc-text">同名检测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#选择模板"><span class="toc-number">7.</span> <span class="toc-text">选择模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#拷贝模板"><span class="toc-number">8.</span> <span class="toc-text">拷贝模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#提示完成"><span class="toc-number">9.</span> <span class="toc-text">提示完成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#最后"><span class="toc-number">10.</span> <span class="toc-text">最后</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Joker</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/qytayh" target="_blank" rel="noopener">follow me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">150</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">29</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">32</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Joker's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/resume">Resume</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">2022/01/[Varlet]实战篇：gen个项目/index</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-01-24</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>到这里，相信小伙伴们已经对<code>cli</code>搭建要使用的工具有了一定了解。如果对相应的工具比较陌生，可以移步本<a href="https://juejin.cn/column/7047326390311452679" target="_blank" rel="noopener">专栏</a> 的前几篇内容。里面有相应介绍。</p>
<p>从这篇开始，我们将一步步得实现<code>cli</code>中的一些功能。</p>
<a id="more"></a>

<h2 id="构建命令"><a href="#构建命令" class="headerlink" title="构建命令"></a>构建命令</h2><p>在<code>varlet-cli</code>中，我们使用<code>gen</code>作为我们的构建命令，先介绍一下什么是<code>gen</code>。</p>
<p><code>gen</code>为<code>generate</code>的简写，用法与我们熟知的<code>vuecli</code>的<code>create</code>类似，用来创建一个组件库项目。</p>
<p>当然，小伙伴们也可以使用各种自己喜欢的命令名~本篇我们依旧以<code>gen</code>作为我们的构建命令。</p>
<h2 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h2><p>我们先将项目的目录结构调整一下。</p>
<p><img src="1.png" alt="image.png"></p>
<ul>
<li><p><code>generators</code>:用于存放<code>gen</code>命令构建出项目的模板文件</p>
</li>
<li><p><code>site</code>:用于存放文档站点</p>
</li>
<li><p><code>src</code>:不用多说，<code>cli</code>的核心部分都在这里了</p>
</li>
</ul>
<blockquote>
<p>因为本文以<code>cli</code>的搭建为主，<code>generators</code>和<code>site</code>部分的代码我们不做过多笔墨，有兴趣的小伙伴们可以前往我们的 <a href="https://github.com/varletjs/varlet" target="_blank" rel="noopener">代码仓库</a>查看</p>
</blockquote>
<h2 id="老朋友commander"><a href="#老朋友commander" class="headerlink" title="老朋友commander"></a>老朋友commander</h2><p>在之前的<a href="https://juejin.cn/post/7049371534380498951" target="_blank" rel="noopener">《进阶篇：好用的工具(上)》</a>中我们已经对<code>commander</code>的基本使用做了介绍，接下来就是让它发挥实力的时候了。</p>
<h3 id="Step1-引用"><a href="#Step1-引用" class="headerlink" title="Step1.引用"></a>Step1.引用</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Command &#125;  <span class="keyword">from</span> <span class="string">"commander"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> program = <span class="keyword">new</span> Command()</span><br><span class="line"></span><br><span class="line">program.version(<span class="built_in">require</span>(<span class="string">'../package.json'</span>).version, <span class="string">'-v, --version'</span>)</span><br><span class="line"></span><br><span class="line">program.parse()</span><br></pre></td></tr></table></figure>

<h3 id="创建gen命令"><a href="#创建gen命令" class="headerlink" title="创建gen命令"></a>创建gen命令</h3><p>我们在<code>src/commands/gen</code>中暴露一个<code>gen</code>方法用来处理<code>gen</code>命令</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">gen</span>(<span class="params">name:<span class="built_in">string</span></span>)</span>&#123;</span><br><span class="line">   <span class="comment">// some code do gen action</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们在入口文件中使用这个<code>gen</code>方法。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; gen &#125; <span class="keyword">from</span> <span class="string">'./commands/gen'</span></span><br><span class="line"></span><br><span class="line">program.command(<span class="string">'gen &lt;name&gt;'</span>).description(<span class="string">'Generate cli application'</span>).action(gen)</span><br></pre></td></tr></table></figure>

<h2 id="gen要做啥"><a href="#gen要做啥" class="headerlink" title="gen要做啥"></a>gen要做啥</h2><p>既然命令已经有了，我们要先明确<code>gen</code>要做的事情：</p>
<ul>
<li>接收用户输入的项目名称</li>
<li>检测当前目录中是否已经存在同名目录，有则提示，无则继续流程</li>
<li>提示用户选择模板</li>
<li>将用户选择的模板拷贝到目的目录</li>
<li>提示用户创建完成</li>
</ul>
<p>接下来我们将按上面的步骤逐步实现<code>gen</code></p>
<h2 id="同名检测"><a href="#同名检测" class="headerlink" title="同名检测"></a>同名检测</h2><p>我们接受用户输入的<code>name</code>，并拼接最终路径，通过<code>fs-extra</code>的<code>pathExistsSync</code>方法判读该路径是否存在。</p>
<p>如果存在则提示并终止程序。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dest = resolve(process.cwd(), name)</span><br><span class="line"><span class="keyword">if</span>(pathExistsSync(dest))&#123;</span><br><span class="line">    logger.warning(<span class="string">`<span class="subst">$&#123;name&#125;</span> already exists and cannot be recreated...`</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们在<code>write-cli</code>项目的同级目录试一下<code>gen</code></p>
</blockquote>
<p><img src="2.png" alt="image.png"></p>
<h2 id="选择模板"><a href="#选择模板" class="headerlink" title="选择模板"></a>选择模板</h2><p>我们使用<code>inquirer</code>来编辑交互</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ret = <span class="keyword">await</span> inquirer.prompt([</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Please select your component library programming style'</span>,</span><br><span class="line">    <span class="keyword">type</span>: <span class="string">'list'</span>,</span><br><span class="line">    choices: [<span class="string">'sfc'</span>, <span class="string">'tsx'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">])</span><br><span class="line"><span class="keyword">const</span> choice = ret[<span class="string">'Please select your component library programming style'</span>]</span><br></pre></td></tr></table></figure>

<p>这里的<code>choice</code>就是用户选择的模板类似</p>
<p><img src="3.png" alt="image.png"></p>
<h2 id="拷贝模板"><a href="#拷贝模板" class="headerlink" title="拷贝模板"></a>拷贝模板</h2><p>我们先定义模板所在目录，然后拿到项目的基本文件目录以及模板目录，然后将其拷贝到定义项目的目录中。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> GENERATORS_DIR = resolve(__dirname, <span class="string">'../../generators'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> generator = resolve(GENERATORS_DIR, choice)</span><br><span class="line"><span class="keyword">const</span> base = resolve(GENERATORS_DIR, <span class="string">'base'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> copy(base, dest)</span><br><span class="line"><span class="keyword">await</span> copy(generator, dest)</span><br></pre></td></tr></table></figure>

<p><img src="4.png" alt="image.png"></p>
<p>这样我们就完成了项目的创建。</p>
<h2 id="提示完成"><a href="#提示完成" class="headerlink" title="提示完成"></a>提示完成</h2><p>但是这样突然就完成了是不是有些不太友好呢，接下来我们来加入提示。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">logger.success(<span class="string">'Application generated successfully!'</span>)</span><br><span class="line">logger.info(<span class="string">`\</span></span><br><span class="line"><span class="string">  cd <span class="subst">$&#123;name&#125;</span></span></span><br><span class="line"><span class="string">  yarn</span></span><br><span class="line"><span class="string">  yarn dev`</span>)</span><br><span class="line">  logger.success(<span class="string">`\</span></span><br><span class="line"><span class="string">=======================</span></span><br><span class="line"><span class="string">  Good luck have fun</span></span><br><span class="line"><span class="string">=======================\</span></span><br><span class="line"><span class="string">      `</span>)</span><br></pre></td></tr></table></figure>

<p><img src="5.png" alt="image.png"></p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>以上就是<code>gen</code>命令的相关内容了，跟<code>varlet-cli</code>的<code>gen</code>相比删减了一些不影响正常创建的内容。</p>
<blockquote>
<p>请参考<a href="https://github.com/varletjs/varlet/blob/dev/packages/varlet-cli/package.json" target="_blank" rel="noopener">相关依赖版本</a>,更详细的<a href="https://github.com/varletjs/varlet/blob/dev/packages/varlet-cli/src/commands/gen.ts" target="_blank" rel="noopener">gen</a>,本文中用到的<a href="https://github.com/varletjs/varlet/blob/dev/packages/varlet-cli/src/shared/logger.ts" target="_blank" rel="noopener">logger</a></p>
</blockquote>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Joker</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://qytayh.github.io/2022/01/[Varlet]%E5%AE%9E%E6%88%98%E7%AF%87%EF%BC%9Agen%E4%B8%AA%E9%A1%B9%E7%9B%AE/index/">https://qytayh.github.io/2022/01/[Varlet]%E5%AE%9E%E6%88%98%E7%AF%87%EF%BC%9Agen%E4%B8%AA%E9%A1%B9%E7%9B%AE/index/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://qytayh.github.io">Joker's Blog</a>！</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/01/%5B%E8%B7%AF%E9%A3%9E%5D%5BLeetCode%5D%E5%89%91%E6%8C%87%20Offer%2010-%20I_%20%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/index/"><i class="fa fa-chevron-left">  </i><span>2022/01/[路飞][LeetCode]剑指 Offer 10- I_ 斐波那契数列/index</span></a></div><div class="next-post pull-right"><a href="/2022/01/%5B%E8%B7%AF%E9%A3%9E%5D%5BLeetCode%5D226_%E7%BF%BB%E8%BD%AC%E4%BA%8C%E5%8F%89%E6%A0%91/index/"><span>2022/01/[路飞][LeetCode]226_翻转二叉树/index</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2020 - 2022 By Joker</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>